config {
  type: "incremental",
  schema: "wiki_push",
  bigquery: {
    partitionBy: "date(timestamp)",
    clusterBy: ["user"]
  }
}

select
  user,
  title,
  timestamp,
  current_timestamp() as processed_time
from
  wiki_push.wiki_changes

${ when(incremental(), `WHERE timestamp > (SELECT MAX(timestamp) FROM ${self()})`) }
